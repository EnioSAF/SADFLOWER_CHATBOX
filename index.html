<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Twitch Chat â€” Diagnostic</title>
  <style>
    body {
      margin: 0;
      background: #1a1a1a;
      color: #fff;
      font-family: monospace;
      padding: 20px;
    }

    .status {
      padding: 10px;
      margin: 10px 0;
      border-radius: 5px;
      border-left: 4px solid;
    }

    .ok {
      background: rgba(0, 255, 0, 0.1);
      border-color: #0f0;
    }

    .error {
      background: rgba(255, 0, 0, 0.1);
      border-color: #f00;
    }

    .info {
      background: rgba(0, 150, 255, 0.1);
      border-color: #09f;
    }
  </style>
</head>

<body>

  <h1>ğŸ” Diagnostic de l'Overlay Twitch</h1>
  <div id="log"></div>

  <script>
    const log = document.getElementById('log');

    function addLog(msg, type = 'info') {
      const div = document.createElement('div');
      div.className = `status ${type}`;
      div.textContent = msg;
      log.appendChild(div);
    }

    // Test 1: Chargement de tmi.js
    addLog('â³ Tentative de chargement de tmi.js...', 'info');

    const script = document.createElement('script');
    script.src = './tmi.min.js';

    script.onload = () => {
      addLog('âœ… tmi.min.js chargÃ© avec succÃ¨s !', 'ok');

      // Test 2: VÃ©rifier si window.tmi existe
      setTimeout(() => {
        if (window.tmi) {
          addLog('âœ… window.tmi est disponible', 'ok');
          addLog('âœ… Version TMI: ' + (window.tmi.Client ? 'Client trouvÃ©' : 'Client introuvable'), window.tmi.Client ? 'ok' : 'error');

          // Test 3: Essayer de se connecter
          addLog('â³ Tentative de connexion Ã  Twitch...', 'info');
          try {
            const client = new window.tmi.Client({
              connection: { secure: true, reconnect: true },
              channels: ['#eniosadflower']
            });

            client.on('connected', (address, port) => {
              addLog(`âœ… CONNECTÃ‰ Ã  Twitch IRC (${address}:${port})`, 'ok');
              addLog('ğŸ‰ Tout fonctionne ! Tu peux utiliser l\'overlay complet.', 'ok');
            });

            client.on('disconnected', (reason) => {
              addLog(`âš ï¸ DÃ©connectÃ©: ${reason}`, 'error');
            });

            client.connect().catch(err => {
              addLog('âŒ Erreur de connexion: ' + err.message, 'error');
            });

          } catch (err) {
            addLog('âŒ Erreur lors de la crÃ©ation du client: ' + err.message, 'error');
          }

        } else {
          addLog('âŒ window.tmi n\'existe pas aprÃ¨s chargement', 'error');
          addLog('ğŸ’¡ Le fichier tmi.min.js est peut-Ãªtre corrompu', 'info');
        }
      }, 100);
    };

    script.onerror = (err) => {
      addLog('âŒ Ã‰chec du chargement de tmi.min.js', 'error');
      addLog('ğŸ’¡ VÃ©rifie que tmi.min.js est dans le mÃªme dossier', 'info');
      addLog('ğŸ’¡ TÃ©lÃ©charge-le ici: https://cdn.jsdelivr.net/npm/tmi.js@1.8.5/dist/tmi.min.js', 'info');
    };

    document.head.appendChild(script);

    // Info supplÃ©mentaires
    addLog('ğŸ“ URL actuelle: ' + window.location.href, 'info');
    addLog('ğŸŒ Protocole: ' + window.location.protocol, 'info');
  </script>

</body>

</html>